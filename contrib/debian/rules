#!/usr/bin/make -f

# Feature toggles. These definitions are simply overrides, everything is
# disabled by default. Refer to FEATURE_NAMES below for a complete list.
with_aggregation=1
with_apache=1
with_cpu=1
with_curl=1
with_curl_json=1
with_curl_xml=1
with_df=1
with_disk=1
with_entropy=1
with_exec=1
with_filecount=1
with_interface=1
with_mysql=1
with_ping=1
with_write_http=1
with_load=1
with_logfile=1
with_memcached=1
with_memory=1
with_network=1
with_processes=1
with_protocols=1
with_statsd=1
with_swap=1
with_syslog=1
with_tail=1
with_tcpconns=1
with_unixsock=1
with_uptime=1
with_vmem=1
with_write_graphite=1
with_match_empty_counter=1
with_match_hashed=1
with_match_regex=1
with_match_timediff=1
with_match_value=1
with_target_notification=1
with_target_replace=1
with_target_scale=1
with_target_set=1

FEATURES=
FEATURE_NAMES=aggregation amqp apache apcups apple_sensors aquaero ascent \
battery bind cgroups conntrack contextswitch cpu cpufreq csv curl curl_json \
curl_xml dbi libdbi df disk dns email entropy ethstat exec filecount fscache \
gmond hddtemp interface ipmi iptables ipvs java libvirt lpar lvm memcachec \
mic modbus multimeter mysql netapp netlink nginx notify_desktop notify_email \
libesmtp nut onewire oracle perl pf pinba ping postgresql python redis \
routeros rrdcached rrdtool sensors sigrok snmp tape tokyotyrant varnish \
write_http write_mongodb libmongoc write_redis libcredis xmms zfs_arc irq load \
logfile madwifi mbmon md memcached memory network nfs ntpd numa olsrd openvpn \
powerdns processes protocols serial statsd swap syslog table tail tail_csv \
tcpconns teamspeak2 ted thermal threshold unixsock uptime users uuid vmem \
vserver wireless write_graphite match_empty_counter match_hashed match_regex \
match_timediff match_value target_notification target_replace target_scale \
target_set target_v5upgrade

define FEATURE
ifeq ($$(with_$1),1)
	FEATURES += --enable-$1
else
	FEATURES += --disable-$1
endif
endef

$(foreach ft,$(FEATURE_NAMES),$(eval $(call FEATURE,$(ft))))

%:
	dh $@

override_dh_auto_configure:
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--disable-static \
		--without-included-ltdl \
		$(FEATURES)

override_dh_auto_build:
	dh_auto_build
	mkdir -p $(CURDIR)/debian/collectd/lib/systemd/system
	mkdir -p $(CURDIR)/debian/collectd/etc/init
	cp contrib/collectd.service \
		$(CURDIR)/debian/collectd/lib/systemd/system
	cp contrib/upstart.collectd.conf \
		$(CURDIR)/debian/collectd/etc/init/collectd.conf
