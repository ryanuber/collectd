#!/usr/bin/make -f

with_aggregation=0
with_amqp=0
with_apache=0
with_apcups=0
with_apple_sensors=0
with_aquaero=0
with_ascent=0
with_battery=0
with_bind=0
with_cgroups=0
with_conntrack=0
with_contextswitch=0
with_cpu=1
with_cpufreq=1
with_csv=0
with_curl=0
with_curl_json=0
with_curl_xml=0
with_dbi=0
with_libdbi=0
with_df=0
with_disk=1
with_dns=0
with_email=0
with_entropy=0
with_ethstat=0
with_exec=1
with_filecount=0
with_fscache=0
with_gmond=0
with_hddtemp=0
with_interface=1
with_ipmi=0
with_iptables=0
with_ipvs=0
with_java=0
with_libvirt=0
with_lpar=0
with_lvm=0
with_memcachec=0
with_mic=0
with_modbus=0
with_multimeter=0
with_mysql=0
with_netapp=0
with_netlink=0
with_nginx=0
with_notify_desktop=0
with_notify_email=0
with_libesmtp=0
with_nut=0
with_onewire=0
with_oracle=0
with_perl=0
with_pf=0
with_pinba=0
with_ping=0
with_postgresql=0
with_python=0
with_redis=0
with_routeros=0
with_rrdcached=0
with_rrdtool=0
with_sensors=0
with_sigrok=0
with_snmp=0
with_tape=0
with_tokyotyrant=0
with_varnish=0
with_write_http=0
with_write_mongodb=0
with_libmongoc=0
with_write_redis=0
with_libcredis=0
with_xmms=0
with_zfs_arc=0
with_irq=0
with_load=1
with_logfile=1
with_madwifi=0
with_mbmon=0
with_md=0
with_memcached=1
with_memory=1
with_network=1
with_nfs=0
with_ntpd=0
with_numa=0
with_olsrd=0
with_openvpn=0
with_powerdns=0
with_processes=1
with_protocols=1
with_serial=0
with_statsd=1
with_swap=1
with_syslog=1
with_table=0
with_tail=0
with_tail_csv=0
with_tcpconns=0
with_teamspeak2=0
with_ted=0
with_thermal=0
with_threshold=0
with_unixsock=1
with_uptime=1
with_users=1
with_uuid=1
with_vmem=1
with_vserver=0
with_wireless=0
with_write_graphite=1
with_write_http=0
with_write_riemann=0

FEATURES=
FEATURE_NAMES=aggregation amqp apache apcups apple_sensors aquaero ascent \
battery bind cgroups conntrack contextswitch cpu cpufreq csv curl curl_json \
curl_xml dbi libdbi df disk dns email entropy ethstat exec filecount fscache \
gmond hddtemp interface ipmi iptables ipvs java libvirt lpar lvm memcachec \
mic modbus multimeter mysql netapp netlink nginx notify_desktop notify_email \
libesmtp nut onewire oracle perl pf pinba ping postgresql python redis \
routeros rrdcached rrdtool sensors sigrok snmp tape tokyotyrant varnish \
write_http write_mongodb libmongoc write_redis libcredis xmms zfs_arc irq load \
logfile madwifi mbmon md memcached memory network nfs ntpd numa olsrd openvpn \
powerdns processes protocols serial statsd swap syslog table tail tail_csv \
tcpconns teamspeak2 ted thermal threshold unixsock uptime users uuid vmem \
vserver wireless write_graphite

define FEATURE
ifeq ($$(with_$1),1)
	FEATURES += --enable-$1
else
	FEATURES += --disable-$1
endif
endef

$(foreach ft,$(FEATURE_NAMES),$(eval $(call FEATURE,$(ft))))

%:
	dh $@

override_dh_auto_configure:
	@echo $(FLAGS)
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--disable-static \
		--without-included-ltdl \
		--enable-match_empty_counter \
		--enable-match_hashed \
		--enable-match_regex \
		--enable-match_timediff \
		--enable-match_value \
		--enable-target_notification \
		--enable-target_replace \
		--enable-target_scale \
		--enable-target_set \
		--enable-target_v5upgrade \
		$(FEATURES)

override_dh_auto_build:
	dh_auto_build
	mkdir -p $(CURDIR)/debian/collectd/lib/systemd/system
	mkdir -p $(CURDIR)/debian/collectd/etc/init
	cp contrib/collectd.service
		$(CURDIR)/debian/collectd/lib/systemd/system
	cp contrib/upstart.collectd.conf
		$(CURDIR)/debian/collectd/etc/init/collectd.conf
